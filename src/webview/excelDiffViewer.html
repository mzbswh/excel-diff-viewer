<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Excel Diff Viewer</title>
		<style nonce="#{cspNonce}">
			/* åŸºç¡€æ ·å¼ */
			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				font-size: 14px;
				line-height: 1.5;
				color: var(--vscode-foreground);
				background-color: var(--vscode-editor-background);
				overflow: hidden;
			}

			/* åŠ è½½çŠ¶æ€ */
			.loading {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 100vh;
				gap: 16px;
			}

			.loading-spinner {
				width: 32px;
				height: 32px;
				border: 3px solid var(--vscode-progressBar-background);
				border-top: 3px solid var(--vscode-progressBar-foreground);
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% { transform: rotate(0deg); }
				100% { transform: rotate(360deg); }
			}

			.loading-text {
				color: var(--vscode-descriptionForeground);
			}

			/* é”™è¯¯çŠ¶æ€ */
			.error {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 100vh;
				gap: 16px;
				text-align: center;
				padding: 20px;
			}

			.error-icon {
				font-size: 48px;
			}

			.error-message {
				color: var(--vscode-errorForeground);
				font-size: 16px;
			}

			/* å·®å¼‚å†…å®¹ */
			.diff-content {
				display: flex;
				flex-direction: column;
				height: 100vh;
			}

			.diff-header {
				background-color: var(--vscode-panel-background);
				border-bottom: 1px solid var(--vscode-panel-border);
				padding: 12px 16px;
			}

			.file-info {
				display: flex;
				gap: 20px;
				margin-bottom: 12px;
			}

			.file-old, .file-new {
				flex: 1;
			}

			.file-label {
				font-weight: 600;
				margin-right: 8px;
			}

			.file-path {
				font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
				font-size: 12px;
				color: var(--vscode-descriptionForeground);
			}

			.diff-summary {
				display: flex;
				gap: 16px;
			}

			.summary-item {
				display: flex;
				align-items: center;
				gap: 4px;
			}

			.summary-label {
				font-size: 12px;
				color: var(--vscode-descriptionForeground);
			}

			.summary-value {
				font-weight: 600;
				font-size: 14px;
			}

			.summary-item.added .summary-value {
				color: var(--vscode-gitDecoration-addedResourceForeground);
			}

			.summary-item.removed .summary-value {
				color: var(--vscode-gitDecoration-deletedResourceForeground);
			}

			.summary-item.modified .summary-value {
				color: var(--vscode-gitDecoration-modifiedResourceForeground);
			}

			/* æ ‡ç­¾é¡µ */
			.diff-tabs {
				flex: 1;
				display: flex;
				flex-direction: column;
				overflow: hidden;
			}

			.tab-list {
				display: flex;
				background-color: var(--vscode-tab-inactiveBackground);
				border-bottom: 1px solid var(--vscode-tab-border);
			}

			.tab-item {
				padding: 8px 16px;
				cursor: pointer;
				border-bottom: 2px solid transparent;
				transition: all 0.2s ease;
			}

			.tab-item:hover {
				background-color: var(--vscode-tab-hoverBackground);
			}

			.tab-item.active {
				background-color: var(--vscode-tab-activeBackground);
				border-bottom-color: var(--vscode-tab-activeBorder);
			}

			.tab-content {
				flex: 1;
				overflow: auto;
				padding: 16px;
			}

			/* è¡¨æ ¼æ ·å¼ */
			.diff-table {
				width: 100%;
				border-collapse: collapse;
				font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
				font-size: 12px;
			}

			.diff-table th,
			.diff-table td {
				border: 1px solid var(--vscode-table-border);
				padding: 4px 8px;
				text-align: left;
				vertical-align: top;
			}

			.diff-table th {
				background-color: var(--vscode-table-headerBackground);
				font-weight: 600;
				position: sticky;
				top: 0;
				z-index: 10;
			}

			.diff-table td {
				background-color: var(--vscode-table-cellBackground);
			}

			/* å·®å¼‚é«˜äº® */
			.cell-added {
				background-color: var(--vscode-gitDecoration-addedResourceForeground) !important;
				color: var(--vscode-gitDecoration-addedResourceForeground);
			}

			.cell-removed {
				background-color: var(--vscode-gitDecoration-deletedResourceForeground) !important;
				color: var(--vscode-gitDecoration-deletedResourceForeground);
			}

			.cell-modified {
				background-color: var(--vscode-gitDecoration-modifiedResourceForeground) !important;
				color: var(--vscode-gitDecoration-modifiedResourceForeground);
			}

			.cell-unchanged {
				background-color: var(--vscode-table-cellBackground);
			}

			/* å·¥å…·ç±» */
			.hidden {
				display: none !important;
			}

			/* å“åº”å¼è®¾è®¡ */
			@media (max-width: 768px) {
				.file-info {
					flex-direction: column;
					gap: 8px;
				}

				.diff-summary {
					flex-wrap: wrap;
					gap: 8px;
				}
			}
		</style>
		#{head}
	</head>

	<body
		data-placement="#{placement}"
		data-vscode-context='{ "webview": "#{webviewId}", "webviewInstance": "#{webviewInstanceId}" }'
	>
		<div id="excel-diff-container">
			<!-- é¡¶éƒ¨å·¥å…·æ  -->
			<div id="toolbar" class="toolbar">
				<div class="toolbar-left">
					<div class="logo">
						<span class="logo-icon">ğŸ“Š</span>
						<span class="logo-text">Excel Diff Viewer</span>
					</div>
				</div>
				<div class="toolbar-center">
					<div class="diff-mode-selector">
						<label for="diff-mode">å¯¹æ¯”æ¨¡å¼:</label>
						<select id="diff-mode" class="mode-select">
							<option value="unified">åˆå¹¶è§†å›¾</option>
							<option value="split">åˆ†å‰²è§†å›¾</option>
							<option value="side-by-side">å¹¶æ’è§†å›¾</option>
						</select>
					</div>
				</div>
				<div class="toolbar-right">
					<div class="theme-toggle">
						<button id="theme-toggle" class="theme-btn" title="åˆ‡æ¢ä¸»é¢˜">
							<span class="theme-icon">ğŸŒ™</span>
						</button>
					</div>
					<div class="settings-toggle">
						<button id="settings-toggle" class="settings-btn" title="è®¾ç½®">
							<span class="settings-icon">âš™ï¸</span>
						</button>
					</div>
				</div>
			</div>

			<!-- è®¾ç½®é¢æ¿ -->
			<div id="settings-panel" class="settings-panel hidden">
				<div class="settings-content">
					<h3>è®¾ç½®</h3>
					<div class="setting-group">
						<label for="theme-select">ä¸»é¢˜:</label>
						<select id="theme-select" class="setting-select">
							<option value="auto">è‡ªåŠ¨</option>
							<option value="light">æµ…è‰²</option>
							<option value="dark">æ·±è‰²</option>
						</select>
					</div>
					<div class="setting-group">
						<label for="highlight-mode">é«˜äº®æ¨¡å¼:</label>
						<select id="highlight-mode" class="setting-select">
							<option value="enhanced">å¢å¼º</option>
							<option value="minimal">ç®€çº¦</option>
							<option value="colorful">å½©è‰²</option>
						</select>
					</div>
					<div class="setting-group">
						<label for="font-size">å­—ä½“å¤§å°:</label>
						<select id="font-size" class="setting-select">
							<option value="small">å°</option>
							<option value="medium" selected>ä¸­</option>
							<option value="large">å¤§</option>
						</select>
					</div>
					<div class="setting-actions">
						<button id="reset-settings" class="btn btn-secondary">é‡ç½®</button>
						<button id="close-settings" class="btn btn-primary">å…³é—­</button>
					</div>
				</div>
			</div>

			<!-- æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
			<div id="file-selection" class="file-selection">
				<div class="file-selection-header">
					<h2>é€‰æ‹©Excelæ–‡ä»¶è¿›è¡Œå¯¹æ¯”</h2>
					<p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©è¦å¯¹æ¯”çš„Excelæ–‡ä»¶</p>
				</div>
				<div class="file-selection-content">
					<div class="file-panel" id="old-file-panel">
						<div class="file-panel-icon">ğŸ“„</div>
						<div class="file-panel-label">ç¬¬ä¸€ä¸ªæ–‡ä»¶</div>
						<div class="file-panel-description">ç‚¹å‡»é€‰æ‹©è¦å¯¹æ¯”çš„ç¬¬ä¸€ä¸ªExcelæ–‡ä»¶</div>
						<div class="file-panel-info hidden" id="old-file-info">
							<div class="file-name" id="old-file-name"></div>
							<div class="file-path" id="old-file-path"></div>
						</div>
						<button class="file-select-btn" id="select-old-file">é€‰æ‹©æ–‡ä»¶</button>
					</div>
					
					<div class="file-panel" id="new-file-panel">
						<div class="file-panel-icon">ğŸ“„</div>
						<div class="file-panel-label">ç¬¬äºŒä¸ªæ–‡ä»¶</div>
						<div class="file-panel-description">ç‚¹å‡»é€‰æ‹©è¦å¯¹æ¯”çš„ç¬¬äºŒä¸ªExcelæ–‡ä»¶</div>
						<div class="file-panel-info hidden" id="new-file-info">
							<div class="file-name" id="new-file-name"></div>
							<div class="file-path" id="new-file-path"></div>
						</div>
						<button class="file-select-btn" id="select-new-file">é€‰æ‹©æ–‡ä»¶</button>
					</div>
				</div>
				<div class="file-selection-controls">
					<button class="btn btn-secondary" id="clear-files">æ¸…é™¤é€‰æ‹©</button>
					<button class="btn btn-primary" id="start-compare" disabled>å¼€å§‹å¯¹æ¯”</button>
				</div>
			</div>

			<!-- åŠ è½½çŠ¶æ€ -->
			<div id="loading" class="loading hidden">
				<div class="loading-spinner"></div>
				<div class="loading-text">æ­£åœ¨æ¯”è¾ƒExcelæ–‡ä»¶...</div>
			</div>

			<!-- é”™è¯¯çŠ¶æ€ -->
			<div id="error" class="error hidden">
				<div class="error-icon">âš ï¸</div>
				<div class="error-message"></div>
			</div>

			<!-- å·®å¼‚å†…å®¹ -->
			<div id="diff-content" class="diff-content hidden">
				<div class="diff-header">
					<div class="file-info">
						<div class="file-old">
							<span class="file-label">æ—§æ–‡ä»¶:</span>
							<span class="file-path"></span>
						</div>
						<div class="file-new">
							<span class="file-label">æ–°æ–‡ä»¶:</span>
							<span class="file-path"></span>
						</div>
					</div>
					<div class="diff-summary">
						<div class="summary-item added">
							<span class="summary-label">æ–°å¢:</span>
							<span class="summary-value"></span>
						</div>
						<div class="summary-item removed">
							<span class="summary-label">åˆ é™¤:</span>
							<span class="summary-value"></span>
						</div>
						<div class="summary-item modified">
							<span class="summary-label">ä¿®æ”¹:</span>
							<span class="summary-value"></span>
						</div>
					</div>
					<div class="diff-controls">
						<button class="btn btn-secondary" id="change-files">æ›´æ¢æ–‡ä»¶</button>
						<button class="btn btn-primary" id="refresh-compare">åˆ·æ–°å¯¹æ¯”</button>
					</div>
				</div>
				<div class="diff-tabs">
					<div class="tab-list"></div>
					<div class="tab-content">
						<!-- åˆå¹¶è§†å›¾ -->
						<div id="unified-view" class="diff-view">
							<div class="unified-content"></div>
						</div>
						
						<!-- åˆ†å‰²è§†å›¾ -->
						<div id="split-view" class="diff-view hidden">
							<div class="split-container">
								<div class="split-pane left-pane">
									<div class="pane-header">
										<span class="pane-title">æ—§æ–‡ä»¶</span>
										<span class="pane-filename"></span>
									</div>
									<div class="pane-content"></div>
								</div>
								<div class="split-divider"></div>
								<div class="split-pane right-pane">
									<div class="pane-header">
										<span class="pane-title">æ–°æ–‡ä»¶</span>
										<span class="pane-filename"></span>
									</div>
									<div class="pane-content"></div>
								</div>
							</div>
						</div>
						
						<!-- å¹¶æ’è§†å›¾ -->
						<div id="side-by-side-view" class="diff-view hidden">
							<div class="side-by-side-container">
								<div class="side-pane left-side">
									<div class="side-header">
										<span class="side-title">æ—§æ–‡ä»¶</span>
										<span class="side-filename"></span>
									</div>
									<div class="side-content"></div>
								</div>
								<div class="side-pane right-side">
									<div class="side-header">
										<span class="side-title">æ–°æ–‡ä»¶</span>
										<span class="side-filename"></span>
									</div>
									<div class="side-content"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script nonce="#{cspNonce}">
			window.bootstrap = #{state};
		</script>
		#{endOfBody}
	</body>
</html>
